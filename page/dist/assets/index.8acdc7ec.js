import{Q as S,a as D,b as B,c as O}from"./QTabPanels.cb12a2c7.js";import{Q as m}from"./QInput.3afb05c8.js";import{Q as I}from"./QForm.9a518ac8.js";import{u as Z,r as t,o as G,q as H,n as J,p as i,k as o,s as r,A as V,av as q,z as Q,y as C}from"./index.fb3f5ad5.js";import{Q as K}from"./QCard.2b2d4094.js";import{u as W,r as X}from"./permission.2824d1cc.js";import{g as Y,p as x}from"./user.c3db126b.js";import{l as E}from"./loading.1b32653b.js";import{n as c}from"./notify.71f93eb9.js";import{u as ee}from"./vue-i18n.runtime.f4bab15f.js";import"./uid.42677368.js";import"./QResizeObserver.7833723c.js";import"./use-timeout.6c0c86b6.js";import"./rtl.b51694b1.js";import"./touch.3df10340.js";import"./selection.2af613b2.js";import"./use-cache.b0833c75.js";import"./use-transition.97bade2a.js";import"./axios.a0958352.js";import"./QInnerLoading.4e21fbf1.js";const le={class:"q-gutter-y-xs q-col-gutter-x-md row"},ae={class:"col-12 col-sm-8 col-md-5 mb-5"},oe=r("div",{class:"col-12 col-sm-4 col-md-7 ma-0"},null,-1),re={class:"col-12 col-sm-8 col-md-5"},se=r("div",{class:"col-12 col-sm-4 col-md-7 ma-0"},null,-1),te={class:"col-12 col-sm-8 col-md-5"},ne=r("div",{class:"col-12 col-sm-4 col-md-7 ma-0"},null,-1),de={class:"row q-gutter-x-md justify-start mt-5"},ie={class:"q-gutter-y-md row"},ue={class:"col-12 col-sm-8 col-md-6"},me=r("div",{class:"col-0 col-sm-4 col-md-6"},null,-1),ce={class:"col-12 col-sm-8 col-md-6"},fe=r("div",{class:"col-0 col-sm-4 col-md-6"},null,-1),pe={class:"col-12 col-sm-8 col-md-6"},ve={class:"row q-gutter-x-md justify-start mt-2"},f="information",P="UserCenter.user",je={__name:"index",setup(we){const j=Z(),{t:s}=ee(),h=W(),p=t(!1),v=t(!1),w=t("info"),U=h.userid,_=t(null),n=t({username:"",name:"",email:""}),$={name:[e=>e&&e.length>0||s("general.form.required")],email:[e=>e&&e.length>0||s("general.form.required"),e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||s(`${P}.emailRule`)]},z=()=>{Y(U).then(e=>{n.value.username=e.data.username,n.value.name=e.data.name,n.value.email=e.data.email}).finally(()=>{v.value=!1})},T=async()=>{if(await _.value.validate()){p.value=!0;const l={name:n.value.name,email:n.value.email};x(U,l).then(a=>{c("success",s("general.form.notify.successfullyEdited")),z()}).catch(a=>{c("error",s("general.form.notify.failed2Edit"),a.response.data.detail)}).finally(()=>{p.value=!1})}else c("error",s("general.form.notify.failed2Edit"),s("general.form.notify.verifyForm"))},A=()=>{j.push("/user-center/group")},d=t({oldPawd:"",newPawd:"",checkPawd:""}),g=t(!0),b=t(!0),y=t(!0),u=t(!1),F=t(null),M=t(null),k={oldPawd:[e=>e&&e.length>0||s("general.form.required")],newPawd:[e=>e&&e.length>0||s("general.form.required"),e=>/^(?=.*[a-zA-Z])(?=.*\d).{8,}$/.test(e)||s(`${P}.pawdRule1`)],checkPawd:[e=>e&&e.length>0||s("general.form.required"),e=>L(e)]},L=async e=>d.value.newPawd.length===0||d.value.newPawd===e?!0:s(`${f}.mismatch`),N=()=>{M.value.validate()},R=async()=>{if(await F.value.validate()){console.log(h.userid);const l={old_password:d.value.oldPawd,new_password:d.value.newPawd};u.value=!0,X(l).then(a=>{c("success",s("general.form.notify.successfullySave")),h.logout()}).catch(a=>{c("error",s("general.form.notify.failed2Save"),a.response.data.detail)}).finally(()=>{u.value=!1})}else c("error",s("general.form.notify.failed2Save"),s("general.form.notify.verifyForm"))};return G(()=>{v.value=!0,z()}),(e,l)=>(H(),J(K,null,{default:i(()=>[o(D,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=a=>w.value=a),class:"bg-grey-3","active-color":"primary","indicator-color":"primary",align:"left"},{default:i(()=>[o(S,{disable:u.value,name:"info",label:e.$t(`${f}.information`),"no-caps":""},null,8,["disable","label"]),o(S,{disable:u.value,name:"changepwd",label:e.$t(`${f}.changePawd`),"no-caps":""},null,8,["disable","label"])]),_:1},8,["modelValue"]),o(O,{modelValue:w.value,"onUpdate:modelValue":l[14]||(l[14]=a=>w.value=a),animated:"","transition-next":"fade","transition-prev":"fade"},{default:i(()=>[o(B,{name:"info"},{default:i(()=>[r("div",null,[o(I,{ref_key:"pageform",ref:_,greedy:""},{default:i(()=>[r("div",le,[r("div",ae,[o(m,{modelValue:n.value.username,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.username=a),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:$.username,label:e.$t(`${P}.account`),disable:""},null,8,["modelValue","placeholder","rules","label"])]),oe,r("div",re,[o(m,{modelValue:n.value.name,"onUpdate:modelValue":l[2]||(l[2]=a=>n.value.name=a),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:$.name,label:e.$t(`${P}.name`)},null,8,["modelValue","placeholder","rules","label"])]),se,r("div",te,[o(m,{modelValue:n.value.email,"onUpdate:modelValue":l[3]||(l[3]=a=>n.value.email=a),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:$.email,label:"Email"},null,8,["modelValue","placeholder","rules"])]),ne])]),_:1},512),V(o(E,null,null,512),[[q,v.value]])]),V(r("div",de,[o(Q,{color:"secondary",rounded:"",label:e.$t("general.btn.cancel"),disable:p.value,onClick:l[4]||(l[4]=a=>A()),"no-caps":""},null,8,["label","disable"]),o(Q,{color:"accent",rounded:"","no-caps":"",label:e.$t("general.btn.edit"),loading:p.value,onClick:l[5]||(l[5]=a=>T())},null,8,["label","loading"])],512),[[q,!v.value]])]),_:1}),o(B,{name:"changepwd"},{default:i(()=>[r("div",null,[o(I,{ref_key:"pwdqform",ref:F,greedy:""},{default:i(()=>[r("div",ie,[r("div",ue,[o(m,{type:g.value?"password":"text",class:"",modelValue:d.value.oldPawd,"onUpdate:modelValue":l[7]||(l[7]=a=>d.value.oldPawd=a),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:k.oldPawd,"no-error-icon":"",autocomplete:"off",label:e.$t(`${f}.oldPawd`)},{append:i(()=>[o(C,{name:g.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[6]||(l[6]=a=>g.value=!g.value)},null,8,["name"])]),_:1},8,["type","modelValue","placeholder","rules","label"])]),me,r("div",ce,[o(m,{type:b.value?"password":"text",class:"",modelValue:d.value.newPawd,"onUpdate:modelValue":l[9]||(l[9]=a=>d.value.newPawd=a),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:k.newPawd,"no-error-icon":"",autocomplete:"off",label:e.$t(`${f}.newPawd`)},{append:i(()=>[o(C,{name:b.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[8]||(l[8]=a=>b.value=!b.value)},null,8,["name"])]),_:1},8,["type","modelValue","placeholder","rules","label"])]),fe,r("div",pe,[o(m,{ref_key:"inputCheckPwd",ref:M,type:y.value?"password":"text",class:"",modelValue:d.value.checkPawd,"onUpdate:modelValue":l[11]||(l[11]=a=>d.value.checkPawd=a),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),rules:k.checkPawd,"no-error-icon":"",autocomplete:"off","lazy-rules":"ondemand",onBlur:l[12]||(l[12]=a=>N()),label:e.$t(`${f}.checkPawd`)},{append:i(()=>[o(C,{name:y.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[10]||(l[10]=a=>y.value=!y.value)},null,8,["name"])]),_:1},8,["type","modelValue","placeholder","rules","label"])])])]),_:1},512),V(o(E,null,null,512),[[q,u.value]])]),r("div",ve,[o(Q,{color:"accent",rounded:"","no-caps":"",label:e.$t("general.btn.save"),disable:u.value,onClick:l[13]||(l[13]=a=>R())},null,8,["label","disable"])])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{je as default};
