import{Q as Z}from"./QInput.3afb05c8.js";import{ar as ee,u as ae,aw as le,r as c,f as V,o as te,q as u,as as g,k as t,p as n,s as d,x as b,cw as se,z as m,v as oe,y as F,B as G,n as S,aM as h,A as ne,av as re,F as ie}from"./index.fb3f5ad5.js";import{Q}from"./QCardSection.4591ffd9.js";import{Q as z}from"./QCard.2b2d4094.js";import{Q as A}from"./QTd.417aa865.js";import{n as ue,Q as de,l as ce}from"./no-data.2e8b8955.js";import{Q as me}from"./QCardActions.5afa793e.js";import{Q as be}from"./QDialog.fc5c29ed.js";import{u as pe}from"./permission.2824d1cc.js";import{g as fe,a as ve,p as ge}from"./aws.035e7a22.js";import{n as _}from"./notify.71f93eb9.js";import{f as ye}from"./table-filter.7923a56f.js";import{u as he}from"./vue-i18n.runtime.f4bab15f.js";import"./use-timeout.6c0c86b6.js";import"./uid.42677368.js";import"./use-transition.97bade2a.js";import"./QSeparator.9cedb50e.js";import"./QList.e0faa10e.js";import"./QSelect.650daa0f.js";import"./QMenu.0d0ddedc.js";import"./position-engine.d6f8c41b.js";import"./selection.2af613b2.js";import"./use-portal.7095234a.js";import"./focusout.c6764dff.js";import"./rtl.b51694b1.js";import"./format.c860d4da.js";import"./QInnerLoading.4e21fbf1.js";import"./axios.a0958352.js";const $e={class:"row q-col-gutter-md"},we={class:"col-12 col-sm-5"},ke={class:"col-12 col-sm-7 row items-end"},Ce={key:0,class:"mb-4 row justify-end"},Se={key:1,class:"null-h52-block"},_e={key:0,class:"text-green-8 row"},Ie={key:1,class:"text-grey-8 row"},Fe={key:0,class:"ma-10 pa-10"},Qe={class:"text-h6"},Ae={class:""},Ne={key:0,class:""},Te={class:""},s="resource.aws.ec2",Be={__name:"index",setup(De){const{t:o,te:P}=he(),N=pe(),E=ae(),x=le(),y=c(!0),K=V(()=>{const a=[{name:"name",align:"left",label:o(`${s}.name`),field:"name",headerClasses:"table-header",classes:"table-body"},{name:"instanceId",align:"left",label:o(`${s}.instanceId`),field:"InstanceId",headerClasses:"table-header",classes:"table-body"},{name:"instanceType",align:"left",label:o(`${s}.type`),field:"InstanceType",headerClasses:"table-header",classes:"table-body"},{name:"os",align:"left",label:o(`${s}.os`),field:"PlatformDetails",headerClasses:"table-header",classes:"table-body"},{name:"state",align:"left",label:o(`${s}.state`),field:"uiFormatStateI18n",headerClasses:"table-header",classes:"table-body"},{name:"vpc",align:"left",label:"IPV4",field:"PublicIpAddress",headerClasses:"table-header",classes:"table-body"},{name:"subnet",align:"left",label:o(`${s}.subnet`),field:"SubnetId",headerClasses:"table-header",classes:"table-body"},{name:"securityGroups",align:"left",label:o(`${s}.securityGroups`),field:"uiFormatSecurityGroups",headerClasses:"table-header",classes:"table-body"},{name:"keypair",align:"left",label:o(`${s}.keypair`),field:"KeyName",headerClasses:"table-header",classes:"table-body"}];return N.role==="supervisor"&&a.push({name:"detail",align:"left",label:o("resource.aws.detail"),field:"detail",headerClasses:"table-header",classes:"table-body",filter:!1},{name:"actions",align:"left",label:o("general.table.actions"),field:"actions",headerClasses:"table-header",classes:"table-body",filter:!1}),a}),M={rowsPerPage:10,sortBy:"updatedTime",descending:!0},j=[0,10,20],$=c(""),T=c(""),B=()=>{T.value=$.value,r.value=[],w()},L=()=>{$.value="",R.value="all"},R=c("all"),q=(a,e,l)=>ye(l,a,e),O=V(()=>(r.value.forEach((a,e)=>{if(a.State===null?(r.value[e].uiFormatState="",r.value[e].uiFormatStateI18n=""):(r.value[e].uiFormatState=a.State.Name,r.value[e].uiFormatStateI18n=P(`${s}.${a.State.Name}`)?o(`${s}.${a.State.Name}`):a.State.Name),a.SecurityGroups.length===0)r.value[e].uiFormatSecurityGroups="";else{let l="";a.SecurityGroups.forEach((v,Y)=>{a.SecurityGroups.length===Y+1?l+=v.GroupName:l+=`${v.GroupName},`}),r.value[e].uiFormatSecurityGroups=l}}),r.value)),U=()=>{setTimeout(()=>{x.path==="/aws-resource/ec2"&&w()},1e3*60)},r=c([]),w=()=>{y.value=!0;let a=!1;fe().then(e=>{r.value=e.data,r.value.forEach((l,v)=>{(l.State.Name==="stopping"||l.State.Name==="pending")&&(a=!0)}),a&&U()}).finally(()=>{y.value=!1})},W=()=>!!(r.value.length===0&&y.value),D=a=>{ve("/compute/ec2").then(e=>{a!=="noMessage"&&_("success",o("resource.aws.successfullyAsync"))}).catch(e=>{_("error",o("resource.aws.failed2Async"),e.response.data.detail)})},H=()=>{E.push("/aws-resource/add-ec2")},J=a=>{window.open(a,"_blank")},p=c(!1),f=c(!1),i=c({name:"",instanceid:"",action:""}),k=c(""),C=c(""),I=(a,e)=>{i.value.instanceid=a.InstanceId,i.value.name=a.name,i.value.action=e,e==="stop"?(k.value=o(`${s}.stopTitle`),C.value=o(`${s}.stopContent`),f.value=!0,p.value=!1):e==="start"?(k.value=o(`${s}.startTitle`),C.value=o(`${s}.startContent`),f.value=!0,p.value=!1):e==="reboot"&&(k.value=o(`${s}.rebootTitle`),C.value=o(`${s}.rebootContent`),f.value=!0,p.value=!1)},X=()=>{p.value=!0;const a={InstanceId:i.value.instanceid,Status:i.value.action};ge(a).then(e=>{f.value=!1,_("success",o(`${s}.successfull2Action`)),i.value.instanceid="",i.value.name="",i.value.action="",w()}).catch(e=>{D("noMessage"),_("error",o(`${s}.failed2Action`),e.response.data.detail)}).finally(()=>{p.value=!1})};return w(),te(()=>{}),(a,e)=>(u(),g(ie,null,[t(z,{class:"bg-grey-11 shadow-1 mb-4 text-weight-medium"},{default:n(()=>[t(Q,null,{default:n(()=>[d("div",$e,[d("div",we,[d("div",null,b(a.$t("general.table.keyword")),1),t(Z,{dense:"",placeholder:a.$t("general.table.enterKeyword"),modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=l=>$.value=l),onKeyup:e[1]||(e[1]=se(l=>B(),["enter"]))},null,8,["placeholder","modelValue"])]),d("div",ke,[t(m,{class:"mr-2",color:"primary",icon:"mdi-magnify",label:a.$t("general.btn.search"),onClick:e[2]||(e[2]=l=>B()),rounded:"","no-caps":""},null,8,["label"]),t(m,{color:"secondary",icon:"mdi-eraser",label:a.$t("general.btn.reset"),onClick:e[3]||(e[3]=l=>L()),rounded:"","no-caps":""},null,8,["label"])])])]),_:1})]),_:1}),oe(N).role==="supervisor"?(u(),g("div",Ce,[t(m,{class:"mr-2",color:"accent",icon:"mdi-cloud-sync-outline",label:a.$t("general.btn.schedule"),onClick:e[4]||(e[4]=l=>D()),rounded:"","no-caps":""},null,8,["label"]),t(m,{class:"",color:"accent",icon:"mdi-plus-circle-outline",label:a.$t("general.btn.add"),onClick:e[5]||(e[5]=l=>H()),rounded:"","no-caps":""},null,8,["label"])])):(u(),g("div",Se)),t(de,{"card-class":"customer-table",rows:O.value,columns:K.value,"row-key":"id",loading:y.value,"loading-label":" ","hide-bottom":W(),pagination:M,"rows-per-page-options":j,filter:T.value,"filter-method":q},{"body-cell-state":n(l=>[t(A,{class:"table-body"},{default:n(()=>[l.row.uiFormatState==="running"?(u(),g("div",_e,[t(F,{size:"24px",name:"mdi-check-circle-outline"}),G(" "+b(l.row.uiFormatStateI18n),1)])):(u(),g("div",Ie,[t(F,{size:"24px",name:"mdi-minus-circle-outline"}),G(" "+b(l.row.uiFormatStateI18n),1)]))]),_:2},1024)]),"body-cell-detail":n(l=>[t(A,{class:"table-body"},{default:n(()=>[t(m,{class:"mr-1",color:"primary",icon:"mdi-link-variant",size:"sm",rounded:"","no-caps":"",onClick:v=>J(l.row.detail_link)},null,8,["onClick"])]),_:2},1024)]),"body-cell-actions":n(l=>[t(A,{class:"table-body"},{default:n(()=>[l.row.uiFormatState==="running"?(u(),S(m,{key:0,class:"mr-1",color:"red-7",label:a.$t(`${s}.stopBtn`),size:"12px",onClick:v=>I(l.row,"stop"),"no-caps":""},null,8,["label","onClick"])):h("",!0),l.row.uiFormatState==="running"?(u(),S(m,{key:1,color:"lime-7",label:a.$t(`${s}.rebootBtn`),size:"12px",onClick:v=>I(l.row,"reboot"),"no-caps":""},null,8,["label","onClick"])):h("",!0),l.row.uiFormatState==="stopped"?(u(),S(m,{key:2,color:"green-7",label:a.$t(`${s}.startBtn`),size:"12px",onClick:v=>I(l.row,"start"),"no-caps":""},null,8,["label","onClick"])):h("",!0)]),_:2},1024)]),loading:n(()=>[r.value.length===0?ne((u(),S(ce,{key:0},null,512)),[[re,y.value]]):h("",!0)]),"bottom-row":n(()=>[y.value&&r.value.length===0?(u(),g("div",Fe)):h("",!0)]),"no-data":n(()=>[t(ue)]),_:1},8,["rows","columns","loading","hide-bottom","filter"]),t(be,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l),persistent:""},{default:n(()=>[t(z,{style:{"min-width":"450px"}},{default:n(()=>[t(Q,null,{default:n(()=>[d("div",Qe,[t(F,{name:"mdi-alert",class:"text-orange mr-1",size:"28px"}),d("span",null,b(k.value),1)])]),_:1}),t(Q,{class:"pt-0"},{default:n(()=>[d("div",Ae,[d("span",null,b(C.value),1)]),i.value.name.length!==0?(u(),g("div",Ne,[d("span",null,b(a.$t(`${s}.name`))+":"+b(i.value.name),1)])):h("",!0),d("div",Te,[d("span",null,b(a.$t(`${s}.instanceId`))+":"+b(i.value.instanceid),1)])]),_:1}),t(me,{align:"center"},{default:n(()=>[t(m,{color:"secondary",rounded:"",label:a.$t("general.btn.cancel"),disable:p.value,onClick:e[6]||(e[6]=l=>f.value=!1),"no-caps":""},null,8,["label","disable"]),t(m,{color:"accent",rounded:"",label:a.$t("general.btn.confirm"),loading:p.value,onClick:e[7]||(e[7]=l=>X()),"no-caps":""},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var ia=ee(Be,[["__scopeId","data-v-0c18e5f0"]]);export{ia as default};
