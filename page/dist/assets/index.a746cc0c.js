import{Q as B}from"./QInput.3afb05c8.js";import{ar as G,aw as J,r as b,f as k,o as X,q as i,as as u,k as l,p as o,s as m,x as c,cw as Z,A as Y,z as _,F as C,ay as ee,av as P,v as M,B as A,aM as $,n as h,y as R,aO as ae,aP as te}from"./index.fb3f5ad5.js";import{Q as le}from"./QCardActions.5afa793e.js";import{d as f,Q as oe,a as se}from"./QPopupProxy.c8c25096.js";import{Q as re}from"./QCardSection.4591ffd9.js";import{Q as ne}from"./QCard.2b2d4094.js";import{Q as D}from"./QTd.417aa865.js";import{Q as U}from"./QTr.e4d3ff92.js";import{n as de,Q as ie,l as me}from"./no-data.2e8b8955.js";import{C as ue}from"./ClosePopup.74952a98.js";import{e as ce}from"./backup.e3930b7b.js";import{f as fe}from"./table-filter.7923a56f.js";import{a as pe}from"./format-time.e227a64b.js";import{u as ve}from"./vue-i18n.runtime.f4bab15f.js";import"./use-timeout.6c0c86b6.js";import"./uid.42677368.js";import"./use-transition.97bade2a.js";import"./use-cache.b0833c75.js";import"./format.c860d4da.js";import"./QDialog.fc5c29ed.js";import"./QSeparator.9cedb50e.js";import"./use-portal.7095234a.js";import"./focusout.c6764dff.js";import"./QMenu.0d0ddedc.js";import"./position-engine.d6f8c41b.js";import"./selection.2af613b2.js";import"./QList.e0faa10e.js";import"./QSelect.650daa0f.js";import"./rtl.b51694b1.js";import"./QInnerLoading.4e21fbf1.js";import"./axios.a0958352.js";const be=g=>(ae("data-v-7248f994"),g=g(),te(),g),he={class:"row q-col-gutter-md"},ge={class:"col-12 col-sm-4"},ye={class:"col-12 col-sm-4"},_e={class:"col-12 col-sm-8 row justify-center"},$e=be(()=>m("div",{class:"null-h52-block"},null,-1)),De={key:0,class:"text-green-8"},we={key:1,class:"text-grey-8"},ke={key:0,class:"text-left text-body1"},Ye={class:"text-weight-bold"},Ce={key:0,class:"ma-10 pa-10"},s="backup.snapshotLog",Me={__name:"index",setup(g){const{t:r,te:z}=ve(),F=J(),p=b(!0),L=k(()=>[{name:"expand",align:"left",label:"",field:"expand",headerClasses:"table-header",classes:"table-body",headerStyle:"width: 20px"},{name:"InstanceId",align:"left",label:r(`${s}.instanceId`),field:"InstanceId",headerClasses:"table-header",classes:"table-body"},{name:"snapshotId",align:"left",label:r(`${s}.snapshotId`),field:"SnapshotId",headerClasses:"table-header",classes:"table-body"},{name:"action",align:"left",label:r(`${s}.action`),field:"formatAction",headerClasses:"table-header",classes:"table-body"},{name:"method",align:"left",label:r(`${s}.method`),field:"formatMethod",headerClasses:"table-header",classes:"table-body"},{name:"state",align:"left",label:r(`${s}.state`),field:"formatState",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"update_time",align:"left",label:r(`${s}.update_time`),field:"formatUpdateTime",headerClasses:"table-header",classes:"table-body",sortable:!0,filter:!1}]),N={rowsPerPage:10,sortBy:"update_time",descending:!0},j=[0,10,20],y=b(""),Q=b(""),S=Date.now(),I=f.formatDate(f.subtractFromDate(S,{days:7}),"YYYY/MM/DD"),x=f.formatDate(S,"YYYY/MM/DD"),n=b({from:I,to:x}),V=()=>{Q.value=y.value,d.value=[],w()},q=()=>{y.value="",n.value={from:I,to:x}},T=k(()=>n.value!==null?typeof n.value=="object"?`${n.value.from}~${n.value.to}`:`${n.value}~${n.value}`:""),E=(t,a,e)=>fe(e,t,a),K=k(()=>(d.value.forEach((t,a)=>{t.method==="manual"?d.value[a].formatMethod=r(`${s}.manual`):d.value[a].formatMethod=r(`${s}.auto`),t.action==="create"?d.value[a].formatAction=r(`${s}.create`):d.value[a].formatAction=r(`${s}.delete`),t.state==="pending"?d.value[a].formatState=r(`${s}.pending`):t.state==="completed"?d.value[a].formatState=r(`${s}.completed`):d.value[a].formatState=r(`${s}.failed`),d.value[a].formatUpdateTime=pe(t.update_time)}),d.value)),d=b([]),H=()=>{setTimeout(()=>{F.path==="/backup/snapshot-log"&&w()},1e3*60)},w=()=>{p.value=!0;let t="";n.value===null?t="":typeof n.value=="object"?t=`?date_from=${f.formatDate(n.value.from,"YYYY-MM-DD")}&date_end=${f.formatDate(n.value.to,"YYYY-MM-DD")}`:t=`?date_from=${f.formatDate(n.value,"YYYY-MM-DD")}&date_end=${f.formatDate(n.value,"YYYY-MM-DD")}`;let a=!1;ce(t).then(e=>{d.value=e.data,e.data.forEach((v,W)=>{v.state==="pending"&&(a=!0)}),a&&H()}).finally(()=>{p.value=!1})},O=()=>!!(d.value.length===0&&p.value);return w(),X(()=>{}),(t,a)=>(i(),u(C,null,[l(ne,{class:"bg-grey-11 shadow-1 mb-4 text-weight-medium"},{default:o(()=>[l(re,null,{default:o(()=>[m("div",he,[m("div",ge,[m("div",null,c(t.$t("general.table.keyword")),1),l(B,{dense:"",placeholder:t.$t("general.table.enterKeyword"),modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),onKeyup:a[1]||(a[1]=Z(e=>V(),["enter"]))},null,8,["placeholder","modelValue"])]),m("div",ye,[m("div",null,c(t.$t("general.table.dateRange")),1),l(B,{dense:"",readonly:"",class:"cursor-pointer",modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e)},{default:o(()=>[l(oe,{"transition-show":"scale","transition-hide":"scale",class:"s123"},{default:o(()=>[l(se,{minimal:"",modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=e=>n.value=e),mask:"YYYY/MM/DD",range:""},{default:o(()=>[l(le,{class:"q-pa-none",align:"around"},{default:o(()=>[Y(l(_,{color:"secondary",label:t.$t("general.btn.close")},null,8,["label"]),[[ue]])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),m("div",_e,[l(_,{class:"mr-2",color:"primary",icon:"mdi-magnify",label:t.$t("general.btn.search"),onClick:a[4]||(a[4]=e=>V()),rounded:"","no-caps":""},null,8,["label"]),l(_,{color:"secondary",icon:"mdi-eraser",label:t.$t("general.btn.reset"),onClick:a[5]||(a[5]=e=>q()),rounded:"","no-caps":""},null,8,["label"])])])]),_:1})]),_:1}),$e,l(ie,{"card-class":"customer-table",rows:K.value,columns:L.value,"row-key":"SnapshotId",loading:p.value,"loading-label":" ","hide-bottom":O(),pagination:N,"rows-per-page-options":j,filter:Q.value,"filter-method":E},{body:o(e=>[l(U,{props:e},{default:o(()=>[(i(!0),u(C,null,ee(e.cols,v=>(i(),u(C,{key:v.name},[v.name==="expand"?(i(),h(D,{key:0,class:"table-body"},{default:o(()=>[e.row.state==="failed"?(i(),h(_,{key:0,size:"sm",color:"accent",round:"",dense:"",onClick:W=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["onClick","icon"])):$("",!0)]),_:2},1024)):v.name==="state"?(i(),h(D,{key:1,class:"table-body"},{default:o(()=>[e.row.state==="completed"?(i(),u("div",De,[l(R,{size:"24px",name:"mdi-check-circle-outline"}),m("span",null,c(e.row.formatState),1)])):(i(),u("div",we,[l(R,{size:"24px",name:"mdi-minus-circle-outline"}),m("span",null,c(e.row.formatState),1)]))]),_:2},1024)):(i(),h(D,{key:2,class:"table-body"},{default:o(()=>[A(c(v.value),1)]),_:2},1024))],64))),128))]),_:2},1032,["props"]),Y(l(U,{props:e},{default:o(()=>[l(D,{colspan:"100%"},{default:o(()=>[e.row.state==="failed"?(i(),u("div",ke,[m("span",Ye,c(M(r)(`${s}.reason`))+": ",1),A(c(M(z)(`${s}.message${e.row.note.code}`)?M(r)(`${s}.message${e.row.note.code}`):e.row.note.message),1)])):$("",!0)]),_:2},1024)]),_:2},1032,["props"]),[[P,e.expand]])]),loading:o(()=>[d.value.length===0?Y((i(),h(me,{key:0},null,512)),[[P,p.value]]):$("",!0)]),"bottom-row":o(()=>[p.value&&d.value.length===0?(i(),u("div",Ce)):$("",!0)]),"no-data":o(()=>[l(de)]),_:1},8,["rows","columns","loading","hide-bottom","filter"])],64))}};var sa=G(Me,[["__scopeId","data-v-7248f994"]]);export{sa as default};
