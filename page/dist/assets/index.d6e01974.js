import{Q as ee}from"./QInput.3afb05c8.js";import{b as ae}from"./QSelect.650daa0f.js";import{r as p,q as h,n as T,p as r,k as e,s as i,y as D,x as c,v as q,z as y,C as te,f as V,h as B,as as S,ar as le,aw as se,o as oe,cw as ne,aM as A,A as re,av as de,F as ie}from"./index.fb3f5ad5.js";import{Q}from"./QCardSection.4591ffd9.js";import{Q as P}from"./QCard.2b2d4094.js";import{Q as U}from"./QTd.417aa865.js";import{u as ue,a as ce,b as me,n as pe,Q as fe,l as ve}from"./no-data.2e8b8955.js";import{b as be,c as ge,d as he}from"./backup.e3930b7b.js";import{f as $e}from"./table-filter.7923a56f.js";import{a as ye}from"./format-time.e227a64b.js";import{a as _e}from"./aws.035e7a22.js";import{n as w}from"./notify.71f93eb9.js";import{Q as N}from"./QCardActions.5afa793e.js";import{Q as H}from"./QDialog.fc5c29ed.js";import{u as j}from"./vue-i18n.runtime.f4bab15f.js";import{Q as Ie}from"./QForm.9a518ac8.js";import"./use-timeout.6c0c86b6.js";import"./uid.42677368.js";import"./use-transition.97bade2a.js";import"./QMenu.0d0ddedc.js";import"./position-engine.d6f8c41b.js";import"./selection.2af613b2.js";import"./use-portal.7095234a.js";import"./focusout.c6764dff.js";import"./rtl.b51694b1.js";import"./format.c860d4da.js";import"./QSeparator.9cedb50e.js";import"./QList.e0faa10e.js";import"./QInnerLoading.4e21fbf1.js";import"./axios.a0958352.js";const ke={class:"text-h6"},Se={class:"text-h6",style:{"word-break":"break-all"}},L="backup.snapshot",we={__name:"delete",emits:["success"],setup(_,{expose:k,emit:s}){const{t:f}=j(),d=p(!1),v=p(!1),m=p({InstanceId:"",SnapshotId:""}),C=o=>{console.log(o),m.value={InstanceId:o.InstanceId,SnapshotId:o.SnapshotId},d.value=!0},R=s,I=async()=>{v.value=!0;const o={SnapshotId:m.value.SnapshotId};be(o).then(t=>{d.value=!1,w("success",f("general.form.notify.successfullyDelete")),R("success")}).catch(t=>{w("error",f("general.form.notify.failed2Delete"),t.response.data.detail)}).finally(()=>{v.value=!1})};return k({openEdit:C}),(o,t)=>(h(),T(H,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=b=>d.value=b),persistent:""},{default:r(()=>[e(P,{style:{width:"450px"}},{default:r(()=>[e(Q,null,{default:r(()=>[i("div",ke,[e(D,{name:"mdi-alert",class:"text-orange mr-1",size:"28px"}),i("span",null,c(o.$t(`${L}.deleteTtile`)),1)])]),_:1}),e(Q,{class:"pt-0"},{default:r(()=>[i("div",Se,c(q(f)(`${L}.deleteContent`)),1),i("div",null,c(m.value.SnapshotId),1)]),_:1}),e(N,{align:"center"},{default:r(()=>[e(y,{color:"secondary",rounded:"",label:o.$t("general.btn.cancel"),disable:v.value,onClick:t[0]||(t[0]=b=>d.value=!1),"no-caps":""},null,8,["label","disable"]),e(y,{color:"accent",rounded:"",label:o.$t("general.btn.confirm"),loading:v.value,onClick:t[1]||(t[1]=b=>I()),"no-caps":""},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var Ce=te({name:"QToggle",props:{...ue,icon:String,iconColor:String},emits:ce,setup(_){function k(s,f){const d=V(()=>(s.value===!0?_.checkedIcon:f.value===!0?_.indeterminateIcon:_.uncheckedIcon)||_.icon),v=V(()=>s.value===!0?_.iconColor:null);return()=>[B("div",{class:"q-toggle__track"}),B("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[B(D,{name:d.value,color:v.value})]:void 0)]}return me("toggle",k)}});const Re={class:"text-h6"},Ve={class:"q-gutter-y-xs q-col-gutter-x-md row"},De={class:"col-12"},Qe={class:"col-12"},xe={class:"col-12"},Te={key:0},Ee={key:1},$="backup.snapshot",ze={__name:"restore",emits:["success"],setup(_,{expose:k,emit:s}){const{t:f}=j(),d=p(!1),v=p(!1),m=p({InstanceId:"",SnapshotId:"",DeleteReplacedRootVolume:!1}),C=o=>{m.value={InstanceId:o.InstanceId,SnapshotId:o.SnapshotId,DeleteReplacedRootVolume:!1},d.value=!0},R=s,I=async()=>{v.value=!0;const o={SnapshotId:m.value.SnapshotId,DeleteReplacedRootVolume:m.value.DeleteReplacedRootVolume};ge(o).then(t=>{d.value=!1,w("success",f(`${$}.successRestore`)),R("success")}).catch(t=>{w("error",f(`${$}.failedRestore`),t.response.data.detail)}).finally(()=>{v.value=!1})};return k({openEdit:C}),(o,t)=>(h(),T(H,{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=b=>d.value=b),persistent:""},{default:r(()=>[e(P,{style:{width:"400px"}},{default:r(()=>[e(Q,null,{default:r(()=>[i("div",Re,[e(D,{name:"mdi-alert",class:"text-orange mr-1",size:"28px"}),i("span",null,c(o.$t(`${$}.restoreTtile`)),1)])]),_:1}),e(Q,{class:"pt-0"},{default:r(()=>[e(Ie,{ref:"pageform",greedy:""},{default:r(()=>[i("div",Ve,[i("div",De,c(q(f)(`${$}.snapshotId`))+":"+c(m.value.SnapshotId),1),i("div",Qe,c(q(f)(`${$}.instanceId`))+":"+c(m.value.InstanceId),1),i("div",xe,[i("div",null,c(o.$t(`${$}.keepLabel`)),1),e(Ce,{modelValue:m.value.DeleteReplacedRootVolume,"onUpdate:modelValue":t[0]||(t[0]=b=>m.value.DeleteReplacedRootVolume=b),"indeterminate-value":"","false-value":!0,"true-value":!1},null,8,["modelValue"]),m.value.DeleteReplacedRootVolume?(h(),S("span",Te,c(o.$t(`${$}.notKeep`)),1)):(h(),S("span",Ee,c(o.$t(`${$}.keep`)),1))])])]),_:1},512)]),_:1}),e(N,{align:"center"},{default:r(()=>[e(y,{color:"secondary",rounded:"",label:o.$t("general.btn.cancel"),disable:v.value,onClick:t[1]||(t[1]=b=>d.value=!1),"no-caps":""},null,8,["label","disable"]),e(y,{color:"accent",rounded:"",label:o.$t(`${$}.restore`),loading:v.value,onClick:t[2]||(t[2]=b=>I()),"no-caps":""},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};const Be={class:"row q-col-gutter-md"},Ae={class:"col-12 col-sm-4"},Ue={class:"col-12 col-sm-4"},qe={class:"col-12 col-sm-8 row justify-center"},Pe={class:"mb-4 row justify-end"},je={key:0,class:"text-green-8"},Fe={key:1,class:"text-grey-8"},Ke={key:0,class:"ma-10 pa-10"},u="backup.snapshot",Le={__name:"index",setup(_){const k=se(),{t:s,te:f}=j(),d=p(!0),v=V(()=>[{text:s(`${u}.restorable`),value:!0},{text:s(`${u}.notRestorable`),value:!1}]),m=V(()=>[{name:"name",align:"left",label:s(`${u}.name`),field:"SnapshotId",headerClasses:"table-header",classes:"table-body"},{name:"snapshotId",align:"left",label:s(`${u}.snapshotId`),field:"SnapshotId",headerClasses:"table-header",classes:"table-body"},{name:"size",align:"left",label:s(`${u}.size`),field:"VolumeSize",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"instanceId",align:"left",label:s(`${u}.instanceId`),field:"InstanceId",headerClasses:"table-header",classes:"table-body"},{name:"storagetier",align:"left",label:s(`${u}.storagetier`),field:"formatStoragetier",headerClasses:"table-header",classes:"table-body"},{name:"state",align:"left",label:s(`${u}.state`),field:"formatState",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"Encrypt",align:"left",label:s(`${u}.Encrypt`),field:"formatEncrypted",headerClasses:"table-header",classes:"table-body"},{name:"startTime",align:"left",label:s(`${u}.startTime`),field:"formatUpdateTime",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"actions",align:"left",label:s("general.table.actions"),field:"actions",headerClasses:"table-header",classes:"table-body",filter:!1}]),C={rowsPerPage:10,sortBy:"",descending:!0},R=[0,10,20],I=p(""),o=p(""),t=p(!0),b=p(!0),x=()=>{o.value=I.value,b.value=t.value,g.value=[],E()},M=()=>{I.value="",t.value=!0,b.value=!0},O=(a,l,n)=>$e(n,a,l),G=V(()=>(g.value.forEach((a,l)=>{g.value[l].formatStoragetier=f(`${u}.${a.StorageTier}`)?s(`${u}.${a.StorageTier}`):a.StorageTier,g.value[l].formatState=f(`${u}.${a.State}`)?s(`${u}.${a.State}`):a.State,a.Encrypted?g.value[l].formatEncrypted=s(`${u}.Encrypted`):g.value[l].formatEncrypted=s(`${u}.NotEncrypted`),g.value[l].formatUpdateTime=ye(a.StartTime)}),g.value)),g=p([]),W=()=>{setTimeout(()=>{k.path==="/backup/snapshot"&&E()},1e3*60)},E=()=>{d.value=!0;let a="";t.value?a="?instance=true":a="?instance=false";let l=!1;he(a).then(n=>{g.value=n.data,n.data.forEach((z,Ne)=>{z.State==="pending"&&(l=!0)}),l&&W()}).finally(()=>{d.value=!1})},J=()=>!!(g.value.length===0&&d.value),X=()=>{_e("/volumes/snapshots").then(a=>{w("success",s("resource.aws.successfullyAsync"))}).catch(a=>{w("error",s("resource.aws.failed2Async"),a.response.data.detail)})},F=p(null),Y=a=>{F.value.openEdit(a)},K=p(null),Z=a=>{K.value.openEdit(a)};return E(),oe(()=>{}),(a,l)=>(h(),S(ie,null,[e(P,{class:"bg-grey-11 shadow-1 mb-4 text-weight-medium"},{default:r(()=>[e(Q,null,{default:r(()=>[i("div",Be,[i("div",Ae,[i("div",null,c(a.$t("general.table.keyword")),1),e(ee,{dense:"",placeholder:a.$t("general.table.enterKeyword"),modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=n=>I.value=n),onKeyup:l[1]||(l[1]=ne(n=>x(),["enter"]))},null,8,["placeholder","modelValue"])]),i("div",Ue,[i("div",null,c(a.$t(`${u}.restore`)),1),e(ae,{modelValue:t.value,"onUpdate:modelValue":l[2]||(l[2]=n=>t.value=n),dense:"",options:v.value,"option-value":"value","option-label":"text","emit-value":"","map-options":""},null,8,["modelValue","options"])]),i("div",qe,[e(y,{class:"mr-2",color:"primary",icon:"mdi-magnify",label:a.$t("general.btn.search"),onClick:l[3]||(l[3]=n=>x()),rounded:"","no-caps":""},null,8,["label"]),e(y,{color:"secondary",icon:"mdi-eraser",label:a.$t("general.btn.reset"),onClick:l[4]||(l[4]=n=>M()),rounded:"","no-caps":""},null,8,["label"])])])]),_:1})]),_:1}),i("div",Pe,[e(y,{class:"",color:"accent",icon:"mdi-cloud-sync-outline",label:a.$t("general.btn.schedule"),onClick:l[5]||(l[5]=n=>X()),rounded:"","no-caps":""},null,8,["label"])]),e(fe,{"card-class":"customer-table",rows:G.value,columns:m.value,"row-key":"id",loading:d.value,"loading-label":" ","hide-bottom":J(),pagination:C,"rows-per-page-options":R,filter:o.value,"filter-method":O},{"body-cell-size":r(n=>[e(U,{class:"table-body"},{default:r(()=>[i("span",null,c(n.row.VolumeSize)+" GiB",1)]),_:2},1024)]),"body-cell-state":r(n=>[e(U,{class:"table-body"},{default:r(()=>[n.row.State==="completed"?(h(),S("div",je,[e(D,{size:"24px",name:"mdi-check-circle-outline"}),i("span",null,c(n.row.formatState),1)])):(h(),S("div",Fe,[e(D,{size:"24px",name:"mdi-minus-circle-outline"}),i("span",null,c(n.row.formatState),1)]))]),_:2},1024)]),"body-cell-actions":r(n=>[e(U,{class:"table-body"},{default:r(()=>[b.value?(h(),T(y,{key:0,color:"primary",label:a.$t(`${u}.restore`),size:"12px",onClick:z=>Z(n.row),"no-caps":"",class:"mr-2"},null,8,["label","onClick"])):A("",!0),e(y,{color:"negative",label:a.$t("general.btn.delete"),size:"12px",onClick:z=>Y(n.row),"no-caps":"",disable:!n.row.created_from_cloud},null,8,["label","onClick","disable"])]),_:2},1024)]),loading:r(()=>[g.value.length===0?re((h(),T(ve,{key:0},null,512)),[[de,d.value]]):A("",!0)]),"bottom-row":r(()=>[d.value&&g.value.length===0?(h(),S("div",Ke)):A("",!0)]),"no-data":r(()=>[e(pe)]),_:1},8,["rows","columns","loading","hide-bottom","filter"]),e(we,{ref_key:"deleteDialogRef",ref:F,onSuccess:l[6]||(l[6]=n=>x())},null,512),e(ze,{ref_key:"restoreDialogRef",ref:K,onSuccess:l[7]||(l[7]=n=>x())},null,512)],64))}};var _a=le(Le,[["__scopeId","data-v-539f1562"]]);export{_a as default};
