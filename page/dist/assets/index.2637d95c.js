import{Q as D}from"./QInput.3afb05c8.js";import{r as i,f as K,q as f,n as A,p as n,k as o,s as p,as as V,x as k,aM as C,y as L,z as h,o as oe,cw as te,B as W,v as O,A as se,av as re,F as ne}from"./index.fb3f5ad5.js";import{Q as N}from"./QCardSection.4591ffd9.js";import{Q as G}from"./QCard.2b2d4094.js";import{b as Z,Q as J}from"./QSelect.650daa0f.js";import{Q as X}from"./QTd.417aa865.js";import{l as ue,n as de,Q as ie}from"./no-data.2e8b8955.js";import{Q as Y}from"./QCardActions.5afa793e.js";import{Q as _}from"./QDialog.fc5c29ed.js";import{u as me}from"./permission.2824d1cc.js";import{a as ce,p as pe,g as fe,d as ve}from"./user.c3db126b.js";import{n as P}from"./notify.71f93eb9.js";import{f as ge}from"./table-filter.7923a56f.js";import{Q as be}from"./QForm.9a518ac8.js";import{g as ye}from"./group.eb0cc308.js";import{u as x}from"./vue-i18n.runtime.f4bab15f.js";import{f as he}from"./format-time.e227a64b.js";import"./use-timeout.6c0c86b6.js";import"./uid.42677368.js";import"./use-transition.97bade2a.js";import"./QMenu.0d0ddedc.js";import"./position-engine.d6f8c41b.js";import"./selection.2af613b2.js";import"./use-portal.7095234a.js";import"./focusout.c6764dff.js";import"./rtl.b51694b1.js";import"./format.c860d4da.js";import"./QSeparator.9cedb50e.js";import"./QList.e0faa10e.js";import"./QInnerLoading.4e21fbf1.js";import"./axios.a0958352.js";const $e={class:"text-h6"},we={key:0},ke={key:1},Ve={class:"q-gutter-y-xs q-col-gutter-x-md row"},Ce={key:0,class:"col-12 col-sm-6"},Pe={class:"col-12 col-sm-6"},Qe={class:"col-12 col-sm-6"},Ue={key:1,class:"col-12 col-sm-6"},De={key:2,class:"col-12 col-sm-6"},Te={key:3,class:"col-12 col-sm-6"},qe={class:"col-12 col-sm-6"},ze={class:"col-12 col-sm-6"},c="UserCenter.user",Ae={__name:"operate",props:{mode:{type:String,required:!0}},emits:["success"],setup(Q,{expose:m,emit:H}){const{t:u}=x(),b=i(null),$=i(!1),w=i(!1),F=Q,a=i({name:"",username:"",note:"",newPawd:"",checkPawd:"",group:null,is_superuser:!0,email:""}),g={name:[e=>e&&e.length>0||u("general.form.required")],username:[e=>e&&e.length>0||u("general.form.required")],note:[!0],newPawd:[e=>e&&e.length>0||u("general.form.required"),e=>/^(?=.*[a-zA-Z])(?=.*\d).{8,}$/.test(e)||u(`${c}.pawdRule1`)],checkPawd:[e=>e&&e.length>0||u("general.form.required"),e=>E(e)],group:[!0],is_superuser:[!0],email:[e=>e&&e.length>0||u("general.form.required"),e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||u(`${c}.emailRule`)]},E=async e=>a.value.newPawd.length===0||a.value.newPawd===e?!0:u(`${c}.mismatch`),T=i(!0),q=i(!0),I=e=>{a.value={name:"",username:"",note:"",newPawd:"",checkPawd:"",group:null,is_superuser:!0,email:""},$.value=!0,B()},M=i(""),v=e=>{a.value={name:e.name,username:e.name,note:e.note,group:null,email:e.email},M.value=e.id,e.group!==null&&(a.value.group=e.group.id),$.value=!0,B()},U=i([]),B=()=>{U.value=[],ye().then(e=>{U.value=e.data.map(l=>({text:l.name,value:l.id}))})},S=K(()=>[{text:u(`${c}.supervisor`),value:!0},{text:u(`${c}.client`),value:!1}]),z=H,R=async()=>{if(await b.value.validate()){w.value=!0;const l={name:a.value.name,username:a.value.username,note:a.value.note,password:a.value.newPawd,group:a.value.group,is_superuser:a.value.is_superuser,email:a.value.email};ce(l).then(t=>{$.value=!1,P("success",u("general.form.notify.successfullyAdded")),z("success")}).catch(t=>{P("error",u("general.form.notify.failed2Add"),t.response.data.detail)}).finally(()=>{w.value=!1})}else P("error",u("general.form.notify.failed2Add"),u("general.form.notify.verifyForm"))},j=async()=>{if(await b.value.validate()){w.value=!0;const l={name:a.value.name,note:a.value.note,group:a.value.group,email:a.value.email};pe(M.value,l).then(t=>{$.value=!1,P("success",u("general.form.notify.successfullyEdited")),z("success")}).catch(t=>{P("error",u("general.form.notify.failed2Edit"),t.response.data.detail)}).finally(()=>{w.value=!1})}else P("error",u("general.form.notify.failed2Edit"),u("general.form.notify.verifyForm"))};return m({open:I,openEdit:v}),(e,l)=>(f(),A(_,{modelValue:$.value,"onUpdate:modelValue":l[13]||(l[13]=t=>$.value=t),persistent:""},{default:n(()=>[o(G,{style:{width:"550px"}},{default:n(()=>[o(N,null,{default:n(()=>[p("div",$e,[F.mode==="add"?(f(),V("span",we,k(e.$t(`${c}.addTtile`)),1)):C("",!0),F.mode==="edit"?(f(),V("span",ke,k(e.$t(`${c}.editTtile`))+" ("+k(a.value.username)+")",1)):C("",!0)]),o(be,{ref_key:"pageform",ref:b,greedy:""},{default:n(()=>[p("div",Ve,[Q.mode==="add"?(f(),V("div",Ce,[o(D,{modelValue:a.value.username,"onUpdate:modelValue":l[0]||(l[0]=t=>a.value.username=t),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:g.username,label:e.$t(`${c}.account`)},null,8,["modelValue","placeholder","rules","label"])])):C("",!0),p("div",Pe,[o(D,{modelValue:a.value.name,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.name=t),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:g.name,label:e.$t(`${c}.name`)},null,8,["modelValue","placeholder","rules","label"])]),p("div",Qe,[o(Z,{modelValue:a.value.group,"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.group=t),placeholder:e.$t("general.form.selectPlaceholder"),options:U.value,"option-value":"value","option-label":"text",label:e.$t(`${c}.group`),clearable:"","emit-value":"","map-options":"",rules:g.group},null,8,["modelValue","placeholder","options","label","rules"])]),Q.mode==="add"?(f(),V("div",Ue,[o(Z,{modelValue:a.value.is_superuser,"onUpdate:modelValue":l[3]||(l[3]=t=>a.value.is_superuser=t),placeholder:e.$t("general.form.selectPlaceholder"),options:S.value,"option-value":"value","option-label":"text",label:e.$t(`${c}.role`),"emit-value":"","map-options":"",rules:g.is_superuser},null,8,["modelValue","placeholder","options","label","rules"])])):C("",!0),Q.mode==="add"?(f(),V("div",De,[o(D,{type:T.value?"password":"text",class:"",modelValue:a.value.newPawd,"onUpdate:modelValue":l[5]||(l[5]=t=>a.value.newPawd=t),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),label:e.$t(`${c}.pawd`),"lazy-rules":"",rules:g.newPawd,"no-error-icon":"",autocomplete:"off",hint:e.$t(`${c}.pawdRule1`)},{append:n(()=>[o(L,{name:T.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[4]||(l[4]=t=>T.value=!T.value)},null,8,["name"])]),_:1},8,["type","modelValue","placeholder","label","rules","hint"])])):C("",!0),Q.mode==="add"?(f(),V("div",Te,[o(D,{type:q.value?"password":"text",class:"",modelValue:a.value.checkPawd,"onUpdate:modelValue":l[7]||(l[7]=t=>a.value.checkPawd=t),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),label:e.$t(`${c}.checkPawd`),"lazy-rules":"",rules:g.checkPawd,"no-error-icon":"",autocomplete:"off"},{append:n(()=>[o(L,{name:q.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[6]||(l[6]=t=>q.value=!q.value)},null,8,["name"])]),_:1},8,["type","modelValue","placeholder","label","rules"])])):C("",!0),p("div",qe,[o(D,{modelValue:a.value.note,"onUpdate:modelValue":l[8]||(l[8]=t=>a.value.note=t),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:g.note,label:e.$t(`${c}.note`)},null,8,["modelValue","placeholder","rules","label"])]),p("div",ze,[o(D,{modelValue:a.value.email,"onUpdate:modelValue":l[9]||(l[9]=t=>a.value.email=t),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:g.email,label:"Email"},null,8,["modelValue","placeholder","rules"])])])]),_:1},512)]),_:1}),o(Y,{align:"right"},{default:n(()=>[o(h,{color:"secondary",rounded:"",label:e.$t("general.btn.cancel"),disable:w.value,onClick:l[10]||(l[10]=t=>$.value=!1),"no-caps":""},null,8,["label","disable"]),Q.mode==="add"?(f(),A(h,{key:0,color:"accent",rounded:"",label:e.$t("general.btn.add"),loading:w.value,onClick:l[11]||(l[11]=t=>R()),"no-caps":""},null,8,["label","loading"])):(f(),A(h,{key:1,color:"accent",rounded:"",label:e.$t("general.btn.edit"),loading:w.value,onClick:l[12]||(l[12]=t=>j()),"no-caps":""},null,8,["label","loading"]))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ee={class:"row q-col-gutter-md"},Se={class:"col-12 col-sm-5"},Fe={class:"col-12 col-sm-7 row items-end"},Me={class:"mb-4 row justify-end"},Be={key:0,class:"ma-10 pa-10"},Ne={class:"text-h6"},Ie={class:"text-h6"},y="UserCenter.user",bl={__name:"index",setup(Q){const{t:m}=x(),u=me().account,b=i(!0),$=K(()=>[{name:"username",align:"left",label:m(`${y}.account`),field:"username",headerClasses:"table-header",classes:"table-body"},{name:"name",align:"left",label:m(`${y}.name`),field:"name",headerClasses:"table-header",classes:"table-body"},{name:"role",align:"left",label:m(`${y}.role`),field:"role",headerClasses:"table-header",classes:"table-body"},{name:"group",align:"left",label:m(`${y}.group`),field:"groupName",headerClasses:"table-header",classes:"table-body"},{name:"email",align:"left",label:"Email",field:"email",headerClasses:"table-header",classes:"table-body"},{name:"note",align:"left",label:m(`${y}.note`),field:"note",headerClasses:"table-header",classes:"table-body"},{name:"updatedTime",align:"left",label:m(`${y}.updatedTime`),field:"formatUpdatedTime",headerClasses:"table-header",classes:"table-body",sortable:!0,filter:!1},{name:"actions",align:"left",label:m("general.table.actions"),field:"actions",headerClasses:"table-header",classes:"table-body",filter:!1}]),w={rowsPerPage:10,sortBy:"updatedTime",descending:!0},F=[0,10,20],a=i(""),g=i(""),E=()=>{g.value=a.value,v.value=[],U()},T=()=>{a.value="",q.value="all"},q=i("all"),I=(s,r,d)=>ge(d,s,r),M=K(()=>(v.value.forEach((s,r)=>{s.group===null?v.value[r].groupName="":v.value[r].groupName=s.group.name,s.is_superuser?v.value[r].role=m(`${y}.supervisor`):v.value[r].role=m(`${y}.client`),v.value[r].formatUpdatedTime=he(s.updated_time)}),v.value)),v=i([]),U=()=>{b.value=!0,fe("").then(s=>{v.value=s.data}).finally(()=>{b.value=!1})},B=()=>!!(v.value.length===0&&b.value),S=i(""),z=i(null),R=()=>{S.value="add",z.value.open("add")},j=s=>{S.value="edit",z.value.openEdit(s)},e=i(!1),l=i(!1),t=i({name:"",id:""}),ee=s=>{t.value.id=s.id,t.value.name=s.username,l.value=!0,e.value=!1},le=()=>{e.value=!0,ve(t.value.id).then(s=>{l.value=!1,P("success",m("general.form.notify.successfullyDelete")),U()}).catch(s=>{P("error",m("general.form.notify.failed2Delete"),s.response.data.detail)}).finally(()=>{e.value=!1})};return U(),oe(()=>{}),(s,r)=>(f(),V(ne,null,[o(G,{class:"bg-grey-11 shadow-1 mb-4 text-weight-medium"},{default:n(()=>[o(N,null,{default:n(()=>[p("div",Ee,[p("div",Se,[p("div",null,k(s.$t("general.table.keyword")),1),o(D,{dense:"",placeholder:s.$t("general.table.enterKeyword"),modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=d=>a.value=d),onKeyup:r[1]||(r[1]=te(d=>E(),["enter"]))},null,8,["placeholder","modelValue"])]),p("div",Fe,[o(h,{class:"mr-2",color:"primary",icon:"mdi-magnify",label:s.$t("general.btn.search"),onClick:r[2]||(r[2]=d=>E()),rounded:"","no-caps":""},null,8,["label"]),o(h,{color:"secondary",icon:"mdi-eraser",label:s.$t("general.btn.reset"),onClick:r[3]||(r[3]=d=>T()),rounded:"","no-caps":""},null,8,["label"])])])]),_:1})]),_:1}),p("div",Me,[o(h,{class:"",color:"accent",icon:"mdi-plus-circle-outline",label:s.$t("general.btn.add"),onClick:r[4]||(r[4]=d=>R()),rounded:"","no-caps":""},null,8,["label"])]),o(ie,{"card-class":"customer-table",rows:M.value,columns:$.value,"row-key":"id",loading:b.value,"loading-label":" ","hide-bottom":B(),pagination:w,"rows-per-page-options":F,filter:g.value,"filter-method":I},{"body-cell-status":n(d=>[o(X,{class:"table-body"},{default:n(()=>[d.row.is_active?(f(),A(J,{key:0,color:"info","text-color":"white",icon:"mdi-play",square:""},{default:n(()=>[W(k(s.$t("general.status.enabled")),1)]),_:1})):(f(),A(J,{key:1,square:"",color:"warning","text-color":"white",icon:"mdi-alert-outline"},{default:n(()=>[W(k(s.$t("general.status.disabled")),1)]),_:1}))]),_:2},1024)]),"body-cell-actions":n(d=>[o(X,{class:"table-body"},{default:n(()=>[o(h,{class:"mr-1",color:"primary",label:s.$t("general.table.edit"),size:"12px",onClick:ae=>j(d.row),"no-caps":""},null,8,["label","onClick"]),O(u)!==d.row.username?(f(),A(h,{key:0,color:"negative",label:s.$t("general.btn.delete"),size:"12px",onClick:ae=>ee(d.row),"no-caps":""},null,8,["label","onClick"])):C("",!0)]),_:2},1024)]),loading:n(()=>[se(o(ue,null,null,512),[[re,b.value]])]),"bottom-row":n(()=>[b.value&&v.value.length===0?(f(),V("div",Be)):C("",!0)]),"no-data":n(()=>[o(de)]),_:1},8,["rows","columns","loading","hide-bottom","filter"]),o(Ae,{ref_key:"operateDialogRef",ref:z,mode:S.value,onSuccess:r[5]||(r[5]=d=>E())},null,8,["mode"]),o(_,{modelValue:l.value,"onUpdate:modelValue":r[8]||(r[8]=d=>l.value=d),persistent:""},{default:n(()=>[o(G,{style:{"min-width":"450px"}},{default:n(()=>[o(N,null,{default:n(()=>[p("div",Ne,[o(L,{name:"mdi-alert",class:"text-orange mr-1",size:"28px"}),p("span",null,k(O(m)(`${y}.deleteTtile`))+" ("+k(t.value.name)+")",1)])]),_:1}),o(N,{class:"pt-0"},{default:n(()=>[p("div",Ie,[p("span",null,k(O(m)(`${y}.deleteContent`)),1)])]),_:1}),o(Y,{align:"center"},{default:n(()=>[o(h,{color:"secondary",rounded:"",label:s.$t("general.btn.cancel"),disable:e.value,onClick:r[6]||(r[6]=d=>l.value=!1),"no-caps":""},null,8,["label","disable"]),o(h,{color:"accent",rounded:"",label:s.$t("general.btn.confirm"),loading:e.value,onClick:r[7]||(r[7]=d=>le()),"no-caps":""},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{bl as default};
