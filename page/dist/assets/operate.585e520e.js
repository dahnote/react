import{Q as E}from"./QCardSection.4591ffd9.js";import{Q as me}from"./QSeparator.9cedb50e.js";import{Q as M}from"./QInput.3afb05c8.js";import{a as I,b as c}from"./QMenu.0d0ddedc.js";import{b as V}from"./QSelect.650daa0f.js";import{Q as fe}from"./QForm.9a518ac8.js";import{Q as ye}from"./QCard.2b2d4094.js";import{u as ge,r as d,f as Z,w as B,o as Ie,q as m,as as be,s as u,k as n,p as o,x as i,v,n as y,B as f,A as W,av as X,z as H,F as xe,cI as _e}from"./index.fb3f5ad5.js";import{b as Ve,c as $e,d as he,e as Se,f as Ae,h as ke,i as Te}from"./aws.035e7a22.js";import{l as Ce}from"./loading.1b32653b.js";import{n as j}from"./notify.71f93eb9.js";import{u as Ge}from"./vue-i18n.runtime.f4bab15f.js";import"./use-timeout.6c0c86b6.js";import"./uid.42677368.js";import"./use-transition.97bade2a.js";import"./position-engine.d6f8c41b.js";import"./selection.2af613b2.js";import"./use-portal.7095234a.js";import"./focusout.c6764dff.js";import"./QDialog.fc5c29ed.js";import"./rtl.b51694b1.js";import"./format.c860d4da.js";import"./axios.a0958352.js";import"./QInnerLoading.4e21fbf1.js";const Le={class:"row"},Ne={class:"q-gutter-y-md q-col-gutter-x-md row"},we={class:"col-12"},De={class:"col-12"},Re=u("div",null,"Application and OS Images",-1),Ke={class:"col-12"},Pe={class:"col-12"},Oe={class:"col-12"},Qe={class:"text-grey-8 text-caption"},Be={class:"mr-2"},je={class:"text-grey-8 text-caption"},qe={class:"mr-2"},ze={class:""},Ue={class:"col-12"},Fe={class:"text-grey-8 text-caption"},Ee={class:""},Me={class:"text-grey-8 text-caption"},Ze={class:""},We={class:"col-12"},Xe={class:"col-6 col-sm-2"},He={class:"col-6 col-sm-10"},Je=u("div",{class:"text-body1"}," GiB ",-1),Ye={class:"row q-gutter-x-md justify-start"},p="resource.aws.ec2",St={__name:"operate",setup(et){const J=ge(),{t:s}=Ge(),{getScrollTarget:Y,setVerticalScrollPosition:ee}=_e,T=d(!1),q=d(!1),z=d(null),a=d({Name:"",ImageId:"",InstanceType:"",KeyName:"",SecurityGroupIds:[],SubnetId:"",AssociatePublicIpAddress:!0,VolumeType:"",VolumeSize:100}),g={Name:[t=>t&&t.length>0||s("general.form.required")],ImageId:[t=>t&&t.length>0||s("general.form.required")],InstanceType:[t=>t&&t.length>0||s("general.form.required")],KeyName:[t=>t&&t.length>0||s("general.form.required")],SecurityGroupIds:[t=>t&&t.length>0||s("general.form.required")],SubnetId:[t=>t&&t.length>0||s("general.form.required")],AssociatePublicIpAddress:[!0],VolumeType:[t=>t&&t.length>0||s("general.form.required")],VolumeSize:[t=>t&&t>0||s("general.form.required")]},te=Z(()=>[{text:s("general.status.enabled"),value:!0},{text:s("general.status.disabled"),value:!1}]);async function le(t){const e=t.$el;ee(Y(e),e.offsetTop,1e3)}const ae=async()=>{await z.value.validate()?(T.value=!0,Ve(a.value).then(e=>{j("success",s("general.form.notify.successfullyAdded")),U()}).catch(e=>{j("error",s("general.form.notify.failed2Add"),e.response.data.detail)}).finally(()=>{T.value=!1})):j("error",s("general.form.notify.failed2Add"),s("general.form.notify.verifyForm"))},U=()=>{J.push("/aws-resource/ec2-log")},h=d([]),C=d(!0),G={},oe=()=>{h.value=[],C.value=!0,$e().then(t=>{h.value=t.data.map(e=>(G[e.ImageId]=e.PlatformDetails,{text:e.Name,value:e.ImageId})),h.value.length>0&&(a.value.ImageId=h.value[0].value)}).finally(()=>{C.value=!1})},x=d([]),L=d(!0);let R=[];const ue=()=>{x.value=[],L.value=!0,he().then(t=>{R=t.data.map(e=>({text:`${e.InstanceType}(${e.DefaultVCpus} vCPU,${e.MemoryInfo} GiB RAM)`,value:e.InstanceType})),x.value=t.data.map(e=>({text:`${e.InstanceType}(${e.DefaultVCpus} vCPU,${e.MemoryInfo} GiB RAM)`,value:e.InstanceType})),x.value.length>0&&(a.value.InstanceType=x.value[0].value)}).finally(()=>{L.value=!1})},se=(t,e)=>{e(()=>{if(t===""){e(()=>{x.value=R});return}const l=t.toLowerCase();x.value=R.filter(r=>r.text.toLowerCase().indexOf(l)>-1)})},S=d(!0),F=d([]),K=d([]),$=Z(()=>{const t=[];return G[a.value.ImageId]!==void 0&&F.value.forEach(e=>{G[a.value.ImageId]==="Windows"?e.type==="rsa"&&t.push({text:e.text,value:e.value}):t.push({text:e.text,value:e.value})}),t});B($,async()=>{a.value.KeyName.length===0&&$.value.length!==0&&(a.value.KeyName=$.value[0].value)}),B(()=>a.value.ImageId,()=>{let t=!1;$.value.forEach(e=>{e.value===a.value.KeyName&&(t=!0)}),t===!1&&(a.value.KeyName="")});const ne=()=>{S.value=!0,Se().then(t=>{F.value=t.data.map(e=>({text:`${e.KeyName}(${e.KeyType})`,value:e.KeyName,type:e.KeyType}))}).finally(()=>{S.value=!1})},re=(t,e)=>{e(()=>{if(t===""){e(()=>{K.value=$.value});return}const l=t.toLowerCase();K.value=$.value.filter(r=>r.text.toLowerCase().indexOf(l)>-1)})},b=d([]),N=d(!0);let P=[];const ie=()=>{b.value=[],N.value=!0,Ae().then(t=>{P=t.data.map(e=>({text:`${`${e.SubnetId} VPC: ${e.VpcId} Availability Zone: ${e.AvailabilityZone} Ip addresses available: ${e.AvailableIpAddressCount} CIDR: ${e.CidrBlock}`}`,value:e.SubnetId,objects:e})),b.value=t.data.map(e=>({text:`${`${e.SubnetId} VPC: ${e.VpcId} Availability Zone: ${e.AvailabilityZone} Ip addresses available: ${e.AvailableIpAddressCount} CIDR: ${e.CidrBlock}`}`,value:e.SubnetId,objects:e})),b.value.length>0&&(a.value.SubnetId=b.value[0].value)}).finally(()=>{N.value=!1})},de=(t,e)=>{e(()=>{if(t===""){e(()=>{b.value=P});return}const l=t.toLowerCase();b.value=P.filter(r=>r.text.toLowerCase().indexOf(l)>-1)})};B(()=>a.value.SubnetId,()=>{pe()});const _=d([]),w=d(!0);let O=[];const pe=()=>{b.value=[],w.value=!0,ke({SubnetId:a.value.SubnetId}).then(t=>{O=t.data.map(r=>({text:`${`${r.Description} ${r.GroupName} ${r.GroupId}`}`,value:r.GroupId,objects:r})),_.value=t.data.map(r=>({text:`${`${r.Description} ${r.GroupName} ${r.GroupId}`}`,value:r.GroupId,objects:r}));const e=t.data.map(r=>r.GroupId);let l=!0;a.value.SecurityGroupIds.forEach(r=>{e.includes(r)===!1&&(l=!1)}),_.value.length>0&&(l===!1||a.value.SecurityGroupIds.length===0)?a.value.SecurityGroupIds=[_.value[0].value]:_.value.length===0&&(a.value.SecurityGroupIds=[])}).finally(()=>{w.value=!1})},ce=(t,e)=>{e(()=>{if(t===""){e(()=>{_.value=O});return}const l=t.toLowerCase();_.value=O.filter(r=>r.text.toLowerCase().indexOf(l)>-1)})},A=d([]),Q=d(!0),D=d({}),ve=()=>{A.value=[],D.value={},Q.value=!0,Te().then(t=>{A.value=t.data.map(e=>({text:`${e.VolumeType}`,value:e.VolumeType})),t.data.forEach(e=>{D.value[`${e.VolumeType}-Windows`]=e.Windows_VolumeSize,D.value[`${e.VolumeType}-Linux/UNIX`]=e.Linux_VolumeSize}),A.value.length>0&&(a.value.VolumeType=A.value[0].value)}).finally(()=>{Q.value=!1})};return Ie(()=>{oe(),ne(),ue(),ie(),ve()}),(t,e)=>(m(),be(xe,null,[u("div",Le,[n(ye,{class:"mb-4 col-12 col-md-9"},{default:o(()=>[n(E,{class:"cloud-card-title"},{default:o(()=>[u("span",null,i(v(s)(`${p}.addTtile`)),1)]),_:1}),n(me,{inset:""}),n(E,null,{default:o(()=>[n(fe,{ref_key:"pageform",ref:z,greedy:"",onValidationError:le},{default:o(()=>[u("div",Ne,[u("div",we,[u("div",null,i(t.$t(`${p}.name`)),1),n(M,{class:"text-body1",modelValue:a.value.Name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.Name=l),modelModifiers:{trim:!0},placeholder:t.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:g.Name},null,8,["modelValue","placeholder","rules"])]),u("div",De,[Re,n(V,{modelValue:a.value.ImageId,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.ImageId=l),options:h.value,"option-value":"value","option-label":"text","emit-value":"","map-options":"","input-debounce":"0",rules:g.ImageId,class:"text-body1",loading:C.value},{"no-option":o(()=>[n(I,null,{default:o(()=>[C.value?(m(),y(c,{key:0,class:"text-grey"},{default:o(()=>[f(" Loading... ")]),_:1})):(m(),y(c,{key:1,class:"text-grey"},{default:o(()=>[f(i(v(s)(`${p}.noResults`)),1)]),_:1}))]),_:1})]),_:1},8,["modelValue","options","rules","loading"])]),u("div",Ke,[u("div",null,i(v(s)(`${p}.type`)),1),n(V,{modelValue:a.value.InstanceType,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.InstanceType=l),options:x.value,"option-value":"value","option-label":"text","emit-value":"","map-options":"","input-debounce":"0",rules:g.InstanceType,class:"text-body1",loading:L.value,"use-input":"",onFilter:se},{"no-option":o(()=>[n(I,null,{default:o(()=>[L.value?(m(),y(c,{key:0,class:"text-grey"},{default:o(()=>[f(" Loading... ")]),_:1})):(m(),y(c,{key:1,class:"text-grey"},{default:o(()=>[f(i(v(s)(`${p}.noResults`)),1)]),_:1}))]),_:1})]),_:1},8,["modelValue","options","rules","loading"])]),u("div",Pe,[u("div",null,i(v(s)(`${p}.keypair`)),1),n(V,{modelValue:a.value.KeyName,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.KeyName=l),options:K.value,"option-value":"value","option-label":"text","emit-value":"","map-options":"","input-debounce":"0",rules:g.KeyName,class:"text-body1",loading:S.value,"use-input":"",onFilter:re},{"no-option":o(()=>[n(I,null,{default:o(()=>[S.value?(m(),y(c,{key:0,class:"text-grey"},{default:o(()=>[f(" Loading... ")]),_:1})):(m(),y(c,{key:1,class:"text-grey"},{default:o(()=>[f(i(v(s)(`${p}.noResults`)),1)]),_:1}))]),_:1})]),_:1},8,["modelValue","options","rules","loading"])]),u("div",Oe,[u("div",null,i(v(s)(`${p}.addSubnet`)),1),n(V,{modelValue:a.value.SubnetId,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.SubnetId=l),options:b.value,"option-value":"value","option-label":"value","emit-value":"","map-options":"","input-debounce":"0",rules:g.SubnetId,class:"text-body1",loading:N.value,"use-input":"",onFilter:de},{option:o(l=>[n(I,{clickable:"",active:l.selected,onClick:r=>l.toggleOption(l.opt)},{default:o(()=>[n(c,null,{default:o(()=>[u("div",null,i(l.opt.value),1),u("div",Qe,[u("span",Be," VPC: "+i(l.opt.objects.VpcId),1),u("span",null," Availability Zone: "+i(l.opt.objects.AvailabilityZone),1)]),u("div",je,[u("span",qe," Ip addresses available: "+i(l.opt.objects.AvailableIpAddressCount),1),u("span",ze,"CIDR: "+i(l.opt.objects.CidrBlock),1)])]),_:2},1024)]),_:2},1032,["active","onClick"])]),"no-option":o(()=>[n(I,null,{default:o(()=>[N.value?(m(),y(c,{key:0,class:"text-grey"},{default:o(()=>[f(" Loading... ")]),_:1})):(m(),y(c,{key:1,class:"text-grey"},{default:o(()=>[f(i(v(s)(`${p}.noResults`)),1)]),_:1}))]),_:1})]),_:1},8,["modelValue","options","rules","loading"])]),u("div",Ue,[u("div",null,i(v(s)(`${p}.securityGroups`)),1),n(V,{modelValue:a.value.SecurityGroupIds,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.SecurityGroupIds=l),options:_.value,"option-value":"value","option-label":"value","emit-value":"","map-options":"","use-chips":"","input-debounce":"0",rules:g.SecurityGroupIds,class:"text-body1",loading:w.value,"use-input":"",onFilter:ce,multiple:""},{option:o(l=>[n(I,{clickable:"",active:l.selected,onClick:r=>l.toggleOption(l.opt)},{default:o(()=>[n(c,null,{default:o(()=>[u("div",null,i(l.opt.value),1),u("div",Fe,[u("span",Ee,i(l.opt.objects.GroupName),1)]),u("div",Me,[u("span",Ze,i(l.opt.objects.Description),1)])]),_:2},1024)]),_:2},1032,["active","onClick"])]),"no-option":o(()=>[n(I,null,{default:o(()=>[w.value?(m(),y(c,{key:0,class:"text-grey"},{default:o(()=>[f(" Loading... ")]),_:1})):(m(),y(c,{key:1,class:"text-grey"},{default:o(()=>[f(i(v(s)(`${p}.noResults`)),1)]),_:1}))]),_:1})]),_:1},8,["modelValue","options","rules","loading"])]),u("div",We,[u("div",null,i(v(s)(`${p}.publicIP`)),1),n(V,{modelValue:a.value.AssociatePublicIpAddress,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.AssociatePublicIpAddress=l),options:te.value,"option-value":"value","option-label":"text","emit-value":"","map-options":"",rules:g.AssociatePublicIpAddress,class:"text-body1"},{"no-option":o(()=>[n(I,null,{default:o(()=>[n(c,{class:"text-grey"},{default:o(()=>[f(i(v(s)(`${p}.noResults`)),1)]),_:1})]),_:1})]),_:1},8,["modelValue","options","rules"])]),u("div",Xe,[u("div",null,i(v(s)(`${p}.ebsType`)),1),n(V,{modelValue:a.value.VolumeType,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.VolumeType=l),options:A.value,"option-value":"value","option-label":"text","emit-value":"","map-options":"","input-debounce":"0",rules:g.VolumeType,class:"text-body1",loading:Q.value},{"no-option":o(()=>[n(I,null,{default:o(()=>[S.value?(m(),y(c,{key:0,class:"text-grey"},{default:o(()=>[f(" Loading... ")]),_:1})):(m(),y(c,{key:1,class:"text-grey"},{default:o(()=>[f(i(v(s)(`${p}.noResults`)),1)]),_:1}))]),_:1})]),_:1},8,["modelValue","options","rules","loading"])]),u("div",He,[u("div",null,i(v(s)(`${p}.ebsSize`))+" ("+i(D.value[`${a.value.VolumeType}-${G[a.value.ImageId]}`])+")",1),n(M,{class:"text-body1 ml-1",modelValue:a.value.VolumeSize,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.VolumeSize=l),modelModifiers:{number:!0},placeholder:t.$t("general.form.inputPlaceholder"),"lazy-rules":"",rules:g.VolumeSize,type:"number",onkeyup:"value=value.replace(/^(0+)|[^\\d]+/g,'')",style:{"max-width":"240px"}},{append:o(()=>[Je]),_:1},8,["modelValue","placeholder","rules"])])])]),_:1},512),W(n(Ce,null,null,512),[[X,q.value]])]),_:1})]),_:1})]),W(u("div",Ye,[n(H,{color:"secondary",rounded:"",label:t.$t("general.btn.cancel"),disable:T.value,onClick:e[9]||(e[9]=l=>U()),"no-caps":""},null,8,["label","disable"]),n(H,{color:"accent",rounded:"",label:t.$t("general.btn.add"),loading:T.value,onClick:e[10]||(e[10]=l=>ae()),"no-caps":""},null,8,["label","loading"])],512),[[X,!q.value]])],64))}};export{St as default};
