import{Q as C}from"./QInput.3afb05c8.js";import{ar as z,r as v,aw as H,f as D,o as O,q as i,as as p,k as n,p as d,s as u,x as b,cw as W,A as M,z as _,F as S,ay as G,av as J,n as $,aM as V,y as B,B as X,aO as Z,aP as x}from"./index.fb3f5ad5.js";import{Q as ee}from"./QCardActions.5afa793e.js";import{d as m,Q as ae,a as te}from"./QPopupProxy.c8c25096.js";import{Q as le}from"./QCardSection.4591ffd9.js";import{Q as oe}from"./QCard.2b2d4094.js";import{Q as E}from"./QTd.417aa865.js";import{Q as se}from"./QTr.e4d3ff92.js";import{n as re,Q as ne,l as de}from"./no-data.2e8b8955.js";import{C as ie}from"./ClosePopup.74952a98.js";import{f as ue}from"./backup.e3930b7b.js";import{f as me}from"./table-filter.7923a56f.js";import{a as R}from"./format-time.e227a64b.js";import{u as ce}from"./vue-i18n.runtime.f4bab15f.js";import"./use-timeout.6c0c86b6.js";import"./uid.42677368.js";import"./use-transition.97bade2a.js";import"./use-cache.b0833c75.js";import"./format.c860d4da.js";import"./QDialog.fc5c29ed.js";import"./QSeparator.9cedb50e.js";import"./use-portal.7095234a.js";import"./focusout.c6764dff.js";import"./QMenu.0d0ddedc.js";import"./position-engine.d6f8c41b.js";import"./selection.2af613b2.js";import"./QList.e0faa10e.js";import"./QSelect.650daa0f.js";import"./rtl.b51694b1.js";import"./QInnerLoading.4e21fbf1.js";import"./axios.a0958352.js";const fe=g=>(Z("data-v-5bf9c698"),g=g(),x(),g),pe={class:"row q-col-gutter-md"},ve={class:"col-12 col-sm-4"},be={class:"col-12 col-sm-4"},ge={class:"col-12 col-sm-8 row justify-center"},he=fe(()=>u("div",{class:"null-h52-block"},null,-1)),ye={key:0,class:"text-green-8"},De={key:1,class:"text-grey-8"},_e={key:0,class:"ma-10 pa-10"},s="backup.restoreLog",Se={__name:"index",setup(g){const{t:o}=ce(),c=v(!0),P=H(),K=D(()=>[{name:"snapshotId",align:"left",label:o(`${s}.snapshotId`),field:"SnapshotId",headerClasses:"table-header",classes:"table-body"},{name:"InstanceId",align:"left",label:o(`${s}.instanceId`),field:"InstanceId",headerClasses:"table-header",classes:"table-body"},{name:"replaceEbsId",align:"left",label:o(`${s}.replaceEbsId`),field:"AttachedVolume",headerClasses:"table-header",classes:"table-body"},{name:"state",align:"left",label:o(`${s}.state`),field:"formatState",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"keepEBS",align:"left",label:o(`${s}.keepEBS`),field:"formatKeepEBS",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"startTime",align:"left",label:o(`${s}.startTime`),field:"formatStartTime",headerClasses:"table-header",classes:"table-body",sortable:!0,filter:!1},{name:"updateTime",align:"left",label:o(`${s}.updateTime`),field:"formatUpdateTime",headerClasses:"table-header",classes:"table-body",sortable:!0,filter:!1}]),U={rowsPerPage:10,sortBy:"updateTime",descending:!0},A=[0,10,20],h=v(""),k=v(""),Y=Date.now(),w=m.formatDate(m.subtractFromDate(Y,{days:7}),"YYYY/MM/DD"),T=m.formatDate(Y,"YYYY/MM/DD"),r=v({from:w,to:T}),Q=()=>{k.value=h.value,t.value=[],y()},F=()=>{h.value="",r.value={from:w,to:T}},I=D(()=>r.value!==null?typeof r.value=="object"?`${r.value.from}~${r.value.to}`:`${r.value}~${r.value}`:""),L=(a,e,l)=>me(l,a,e),N=D(()=>(t.value.forEach((a,e)=>{a.TaskState==="pending"?(t.value[e].reason="",t.value[e].formatState=o(`${s}.pending`)):a.TaskState==="in-progress"?(t.value[e].reason="",t.value[e].formatState=o(`${s}.inProgress`)):a.TaskState==="succeeded"?(t.value[e].reason="",t.value[e].formatState=o(`${s}.succeeded`)):a.TaskState==="failed-detached"?(t.value[e].reason=o(`${s}.failedDetachedReason`),t.value[e].formatState=o(`${s}.failedDetached`)):(t.value[e].reason=o(`${s}.failedReason`),t.value[e].formatState=o(`${s}.failed`)),a.DeleteReplacedRootVolume?t.value[e].formatKeepEBS=o(`${s}.notKeep`):t.value[e].formatKeepEBS=o(`${s}.keep`),t.value[e].formatStartTime=R(a.StartTime),t.value[e].formatUpdateTime=R(a.update_time)}),t.value)),t=v([]),j=()=>{setTimeout(()=>{P.path==="/backup/restore-log"&&y()},1e3*60)},y=()=>{c.value=!0;let a="";r.value===null?a="":typeof r.value=="object"?a=`?date_from=${m.formatDate(r.value.from,"YYYY-MM-DD")}&date_end=${m.formatDate(r.value.to,"YYYY-MM-DD")}`:a=`?date_from=${m.formatDate(r.value,"YYYY-MM-DD")}&date_end=${m.formatDate(r.value,"YYYY-MM-DD")}`;let e=!1;ue(a).then(l=>{t.value=l.data,l.data.forEach((f,$e)=>{(f.TaskState==="pending"||f.TaskState==="in-progress")&&(e=!0)}),e&&j()}).finally(()=>{c.value=!1})},q=()=>!!(t.value.length===0&&c.value);return y(),O(()=>{}),(a,e)=>(i(),p(S,null,[n(oe,{class:"bg-grey-11 shadow-1 mb-4 text-weight-medium"},{default:d(()=>[n(le,null,{default:d(()=>[u("div",pe,[u("div",ve,[u("div",null,b(a.$t("general.table.keyword")),1),n(C,{dense:"",placeholder:a.$t("general.table.enterKeyword"),modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),onKeyup:e[1]||(e[1]=W(l=>Q(),["enter"]))},null,8,["placeholder","modelValue"])]),u("div",be,[u("div",null,b(a.$t("general.table.dateRange")),1),n(C,{dense:"",readonly:"",class:"cursor-pointer",modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=l=>I.value=l)},{default:d(()=>[n(ae,{"transition-show":"scale","transition-hide":"scale",class:"s123"},{default:d(()=>[n(te,{minimal:"",modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value=l),mask:"YYYY/MM/DD",range:""},{default:d(()=>[n(ee,{class:"q-pa-none",align:"around"},{default:d(()=>[M(n(_,{color:"secondary",label:a.$t("general.btn.close")},null,8,["label"]),[[ie]])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),u("div",ge,[n(_,{class:"mr-2",color:"primary",icon:"mdi-magnify",label:a.$t("general.btn.search"),onClick:e[4]||(e[4]=l=>Q()),rounded:"","no-caps":""},null,8,["label"]),n(_,{color:"secondary",icon:"mdi-eraser",label:a.$t("general.btn.reset"),onClick:e[5]||(e[5]=l=>F()),rounded:"","no-caps":""},null,8,["label"])])])]),_:1})]),_:1}),he,n(ne,{"card-class":"customer-table",rows:N.value,columns:K.value,"row-key":"id",loading:c.value,"loading-label":" ","hide-bottom":q(),pagination:U,"rows-per-page-options":A,filter:k.value,"filter-method":L},{body:d(l=>[n(se,{props:l},{default:d(()=>[(i(!0),p(S,null,G(l.cols,f=>(i(),p(S,{key:f.name},[f.name==="state"?(i(),$(E,{key:0,class:"table-body"},{default:d(()=>[l.row.TaskState==="succeeded"?(i(),p("div",ye,[n(B,{size:"24px",name:"mdi-check-circle-outline"}),u("span",null,b(l.row.formatState),1)])):(i(),p("div",De,[n(B,{size:"24px",name:"mdi-minus-circle-outline"}),u("span",null,b(l.row.formatState),1)]))]),_:2},1024)):(i(),$(E,{key:1,class:"table-body"},{default:d(()=>[X(b(f.value),1)]),_:2},1024))],64))),128))]),_:2},1032,["props"])]),loading:d(()=>[t.value.length===0?M((i(),$(de,{key:0},null,512)),[[J,c.value]]):V("",!0)]),"bottom-row":d(()=>[c.value&&t.value.length===0?(i(),p("div",_e)):V("",!0)]),"no-data":d(()=>[n(re)]),_:1},8,["rows","columns","loading","hide-bottom","filter"])],64))}};var aa=z(Se,[["__scopeId","data-v-5bf9c698"]]);export{aa as default};
