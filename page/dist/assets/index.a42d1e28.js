import{Q as H}from"./QInput.3afb05c8.js";import{r as f,f as B,q as w,n as P,p as s,k as l,s as p,x as g,as as x,aM as N,z as $,o as Z,cw as ee,B as z,A as le,av as ae,y as te,v as O,F as oe}from"./index.fb3f5ad5.js";import{Q as D}from"./QCardSection.4591ffd9.js";import{Q as U}from"./QCard.2b2d4094.js";import{b as A,Q as K}from"./QSelect.650daa0f.js";import{Q as L}from"./QTd.417aa865.js";import{l as ne,n as se,Q as re}from"./no-data.2e8b8955.js";import{Q as R}from"./QCardActions.5afa793e.js";import{Q as j}from"./QDialog.fc5c29ed.js";import{p as ue,g as ie,a as de}from"./backup.e3930b7b.js";import{n as C}from"./notify.71f93eb9.js";import{f as ce}from"./table-filter.7923a56f.js";import{Q as me}from"./QForm.9a518ac8.js";import{u as W}from"./vue-i18n.runtime.f4bab15f.js";import{f as fe}from"./format-time.e227a64b.js";import"./use-timeout.6c0c86b6.js";import"./uid.42677368.js";import"./use-transition.97bade2a.js";import"./QMenu.0d0ddedc.js";import"./position-engine.d6f8c41b.js";import"./selection.2af613b2.js";import"./use-portal.7095234a.js";import"./focusout.c6764dff.js";import"./rtl.b51694b1.js";import"./format.c860d4da.js";import"./QSeparator.9cedb50e.js";import"./QList.e0faa10e.js";import"./QInnerLoading.4e21fbf1.js";import"./axios.a0958352.js";const pe={class:"text-h6"},ve={class:"q-gutter-y-xs q-col-gutter-x-md row"},be={class:"col-12 col-sm-6"},ye={class:"col-12 col-sm-6"},he={key:0,class:"col-12 col-sm-6"},ge={key:1,class:"col-12 col-sm-6"},v="backup.plan",$e={__name:"operate",emits:["success"],setup(G,{expose:u,emit:y}){const{t:m}=W(),V=f(null),k=f(!1),b=f(!1),o=f({InstanceId:"",method:"",frequency:"",hour:0,max_capability:0}),q={max_capability:[e=>e>0||m(`${v}.min0`)],frequency:[e=>e&&e.length>0||m("general.form.required")],hour:[e=>e>=0&&e<24||m(`${v}.min023`),e=>e!==""||m(`${v}.min023`)]},F=()=>{if(o.value.hour!==null&&o.value.hour!==""){let e=Math.floor(o.value.hour);e<0?e=0:e>23&&(e=23),o.value.hour=e}else o.value.hour=""},T=e=>{o.value={InstanceId:e.InstanceId,method:e.method,frequency:e.frequency,hour:e.hour,max_capability:e.max_capability},k.value=!0},M=B(()=>[{text:m(`${v}.manual`),value:"manual"},{text:m(`${v}.auto`),value:"auto"}]),E=B(()=>[{text:m(`${v}.frequencyDay`),value:"day"},{text:m(`${v}.frequencyHour`),value:"hour"}]),i=y,I=async()=>{if(await V.value.validate()){b.value=!0;let n=null,r=null;o.value.method==="manual"?(n=null,r=null):(n=o.value.frequency,n==="day"?r=o.value.hour:r=null);const S={InstanceId:o.value.InstanceId,method:o.value.method,frequency:n,hour:r,max_capability:o.value.max_capability};ue(S).then(h=>{k.value=!1,C("success",m("general.form.notify.successfullyEdited")),i("success")}).catch(h=>{C("error",m("general.form.notify.failed2Edit"),h.response.data.detail)}).finally(()=>{b.value=!1})}else C("error",m("general.form.notify.failed2Edit"),m("general.form.notify.verifyForm"))};return u({openEdit:T}),(e,n)=>(w(),P(j,{modelValue:k.value,"onUpdate:modelValue":n[6]||(n[6]=r=>k.value=r),persistent:""},{default:s(()=>[l(U,{style:{width:"550px"}},{default:s(()=>[l(D,null,{default:s(()=>[p("div",pe,[p("span",null,g(e.$t(`${v}.editTtile`))+" ("+g(o.value.InstanceId)+")",1)]),l(me,{ref_key:"pageform",ref:V,greedy:""},{default:s(()=>[p("div",ve,[p("div",be,[l(A,{modelValue:o.value.method,"onUpdate:modelValue":n[0]||(n[0]=r=>o.value.method=r),placeholder:e.$t("general.form.selectPlaceholder"),options:M.value,"option-value":"value","option-label":"text",label:e.$t(`${v}.method`),"emit-value":"","map-options":""},null,8,["modelValue","placeholder","options","label"])]),p("div",ye,[l(H,{modelValue:o.value.max_capability,"onUpdate:modelValue":n[1]||(n[1]=r=>o.value.max_capability=r),modelModifiers:{trim:!0},placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",label:e.$t(`${v}.capability`),type:"number",onkeyup:"value=value.replace(/^(0+)|[^\\d]+/g,'')",rules:q.max_capability,min:"0"},null,8,["modelValue","placeholder","label","rules"])]),o.value.method==="auto"?(w(),x("div",he,[l(A,{modelValue:o.value.frequency,"onUpdate:modelValue":n[2]||(n[2]=r=>o.value.frequency=r),placeholder:e.$t("general.form.selectPlaceholder"),options:E.value,"option-value":"value","option-label":"text",label:e.$t(`${v}.frequency`),"emit-value":"","map-options":"",rules:q.frequency},null,8,["modelValue","placeholder","options","label","rules"])])):N("",!0),o.value.method==="auto"&&o.value.frequency==="day"?(w(),x("div",ge,[l(H,{modelValue:o.value.hour,"onUpdate:modelValue":n[3]||(n[3]=r=>o.value.hour=r),placeholder:e.$t("general.form.inputPlaceholder"),"lazy-rules":"",label:`${e.$t(`${v}.hour`)}(0~23)`,type:"number",change:F(),rules:q.hour,suffix:":00",min:"0",max:"23"},null,8,["modelValue","placeholder","label","change","rules"])])):N("",!0)])]),_:1},512)]),_:1}),l(R,{align:"right"},{default:s(()=>[l($,{color:"secondary",rounded:"",label:e.$t("general.btn.cancel"),disable:b.value,onClick:n[4]||(n[4]=r=>k.value=!1),"no-caps":""},null,8,["label","disable"]),l($,{color:"accent",rounded:"",label:e.$t("general.btn.edit"),loading:b.value,onClick:n[5]||(n[5]=r=>I()),"no-caps":""},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ke={class:"row q-col-gutter-md"},qe={class:"col-12 col-sm-5"},we={class:"col-12 col-sm-7 row items-end"},Ie=p("div",{class:"py-2"},null,-1),_e={key:0,class:"ma-10 pa-10"},Ce={class:"text-h6"},Ve={class:"text-h6",style:{"word-break":"break-all"}},c="backup.plan",tl={__name:"index",setup(G){const{t:u}=W(),y=f(!0),m=B(()=>[{name:"name",align:"left",label:u(`${c}.name`),field:"name",headerClasses:"table-header",classes:"table-body"},{name:"instanceId",align:"left",label:u(`${c}.instanceId`),field:"InstanceId",headerClasses:"table-header",classes:"table-body"},{name:"method",align:"left",label:u(`${c}.method`),field:"formatMethod",headerClasses:"table-header",classes:"table-body"},{name:"capability",align:"left",label:u(`${c}.capability`),field:"max_capability",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"frequency",align:"left",label:u(`${c}.frequency`),field:"formatFrequency",headerClasses:"table-header",classes:"table-body"},{name:"hour",align:"left",label:u(`${c}.hour`),field:"formatHour",headerClasses:"table-header",classes:"table-body"},{name:"time",align:"left",label:u(`${c}.time`),field:"formatTime",headerClasses:"table-header",classes:"table-body",sortable:!0},{name:"actions",align:"left",label:u("general.table.actions"),field:"actions",headerClasses:"table-header",classes:"table-body",filter:!1}]),V={rowsPerPage:10,sortBy:"updatedTime",descending:!0},k=[0,10,20],b=f(""),o=f(""),q=()=>{o.value=b.value,i.value=[],I()},F=()=>{b.value="",T.value="all"},T=f("all"),M=(a,t,d)=>ce(d,a,t),E=B(()=>(i.value.forEach((a,t)=>{a.method==="manual"?i.value[t].formatMethod=u(`${c}.manual`):i.value[t].formatMethod=u(`${c}.auto`),a.frequency==="day"?i.value[t].formatFrequency=u(`${c}.frequencyDay`):a.frequency==="hour"?i.value[t].formatFrequency=u(`${c}.frequencyHour`):i.value[t].formatFrequency="-",a.hour===null?i.value[t].formatHour="-":i.value[t].formatHour=`${a.hour}:00`,a.last_backup_time===null?i.value[t].formatTime="":i.value[t].formatTime=fe(a.last_backup_time)}),i.value)),i=f([]),I=()=>{y.value=!0,ie().then(a=>{i.value=a.data}).finally(()=>{y.value=!1})},e=()=>!!(i.value.length===0&&y.value),n=f(""),r=f(null),S=a=>{n.value="edit",r.value.openEdit(a)},h=f(!1),_=f(!1),Q=f({instanceName:"",instanceId:""}),J=a=>{Q.value.instanceId=a.InstanceId,Q.value.instanceName=a.name,_.value=!0,h.value=!1},X=()=>{h.value=!0,de({InstanceId:Q.value.instanceId}).then(a=>{_.value=!1,C("success",u(`${c}.successfully2manual`)),I()}).catch(a=>{C("error",u(`${c}.failed2manual`),a.response.data.detail)}).finally(()=>{h.value=!1})};return I(),Z(()=>{}),(a,t)=>(w(),x(oe,null,[l(U,{class:"bg-grey-11 shadow-1 text-weight-medium"},{default:s(()=>[l(D,null,{default:s(()=>[p("div",ke,[p("div",qe,[p("div",null,g(a.$t("general.table.keyword")),1),l(H,{dense:"",placeholder:a.$t("general.table.enterKeyword"),modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=d=>b.value=d),onKeyup:t[1]||(t[1]=ee(d=>q(),["enter"]))},null,8,["placeholder","modelValue"])]),p("div",we,[l($,{class:"mr-2",color:"primary",icon:"mdi-magnify",label:a.$t("general.btn.search"),onClick:t[2]||(t[2]=d=>q()),rounded:"","no-caps":""},null,8,["label"]),l($,{color:"secondary",icon:"mdi-eraser",label:a.$t("general.btn.reset"),onClick:t[3]||(t[3]=d=>F()),rounded:"","no-caps":""},null,8,["label"])])])]),_:1})]),_:1}),Ie,l(re,{"card-class":"customer-table mt-6",rows:E.value,columns:m.value,"row-key":"id",loading:y.value,"loading-label":" ","hide-bottom":e(),pagination:V,"rows-per-page-options":k,filter:o.value,"filter-method":M},{"body-cell-status":s(d=>[l(L,{class:"table-body"},{default:s(()=>[d.row.is_active?(w(),P(K,{key:0,color:"info","text-color":"white",icon:"mdi-play",square:""},{default:s(()=>[z(g(a.$t("general.status.enabled")),1)]),_:1})):(w(),P(K,{key:1,square:"",color:"warning","text-color":"white",icon:"mdi-alert-outline"},{default:s(()=>[z(g(a.$t("general.status.disabled")),1)]),_:1}))]),_:2},1024)]),"body-cell-actions":s(d=>[l(L,{class:"table-body"},{default:s(()=>[l($,{class:"mr-1",color:"primary",label:a.$t("general.table.edit"),size:"12px",onClick:Y=>S(d.row),"no-caps":""},null,8,["label","onClick"]),l($,{color:"accent",label:a.$t(`${c}.manualBackup`),size:"12px",onClick:Y=>J(d.row),"no-caps":""},null,8,["label","onClick"])]),_:2},1024)]),loading:s(()=>[le(l(ne,null,null,512),[[ae,y.value]])]),"bottom-row":s(()=>[y.value&&i.value.length===0?(w(),x("div",_e)):N("",!0)]),"no-data":s(()=>[l(se)]),_:1},8,["rows","columns","loading","hide-bottom","filter"]),l($e,{ref_key:"operateDialogRef",ref:r,onSuccess:t[4]||(t[4]=d=>q())},null,512),l(j,{modelValue:_.value,"onUpdate:modelValue":t[7]||(t[7]=d=>_.value=d),persistent:""},{default:s(()=>[l(U,{style:{"min-width":"350px"}},{default:s(()=>[l(D,null,{default:s(()=>[p("div",Ce,[l(te,{name:"mdi-alert",class:"text-orange mr-1",size:"28px"}),p("span",null,g(O(u)(`${c}.manualBackup`)),1)])]),_:1}),l(D,{class:"pt-0"},{default:s(()=>[p("div",Ve,g(O(u)(`${c}.manualBackupContent`)),1),p("div",null,g(Q.value.instanceId),1)]),_:1}),l(R,{align:"center"},{default:s(()=>[l($,{color:"secondary",rounded:"",label:a.$t("general.btn.cancel"),disable:h.value,onClick:t[5]||(t[5]=d=>_.value=!1),"no-caps":""},null,8,["label","disable"]),l($,{color:"accent","no-caps":"",rounded:"",label:a.$t("general.btn.confirm"),loading:h.value,onClick:t[6]||(t[6]=d=>X())},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{tl as default};
